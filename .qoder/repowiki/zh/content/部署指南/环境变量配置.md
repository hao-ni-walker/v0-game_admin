# 环境变量配置

<cite>
**本文档引用文件**  
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L72-L94)
- [.env.example](file://.env.example#L1-L13)
- [src/lib/auth.ts](file://src/lib/auth.ts#L30)
- [src/config/site.ts](file://src/config/site.ts#L2-L3)
</cite>

## 目录
1. [简介](#简介)
2. [数据库配置](#数据库配置)
3. [JWT安全配置](#jwt安全配置)
4. [应用基本信息配置](#应用基本信息配置)
5. [邮件服务配置](#邮件服务配置)
6. [部署环境管理策略](#部署环境管理策略)
7. [敏感信息加密存储最佳实践](#敏感信息加密存储最佳实践)

## 简介
本系统基于 Next.js 构建，通过环境变量实现灵活的配置管理。环境变量用于定义数据库连接、安全密钥、应用元信息和邮件服务等关键配置。所有环境变量应在 `.env.local` 文件中进行配置，该文件不会被版本控制系统跟踪，确保敏感信息的安全性。

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L72-L94)

## 数据库配置
用于配置系统与数据库的连接信息。

### DATABASE_URL
- **作用**：指定 PostgreSQL 数据库连接字符串
- **格式要求**：`postgresql://用户名:密码@主机:端口/数据库名`
- **示例**：`postgresql://n_admin_user:your_password@localhost:5432/n_admin`
- **安全性建议**：
  - 使用专用数据库用户，避免使用管理员账户
  - 密码应包含大小写字母、数字和特殊字符
  - 在生产环境中使用 SSL 连接
- **默认值**：无（必需配置）

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L78)

## JWT安全配置
用于配置用户认证和会话管理的安全密钥。

### JWT_SECRET
- **作用**：用于签名和验证 JWT 访问令牌
- **格式要求**：
  - 长度至少 32 个字符
  - 应包含大小写字母、数字和特殊字符
  - 推荐使用随机生成的字符串
- **安全性建议**：
  - 必须为高强度随机字符串
  - 不应使用简单单词或可预测的模式
  - 在生产环境中定期轮换
- **默认值**：`your_very_long_random_secret_key`（仅用于开发环境）

### JWT_REFRESH_SECRET
- **作用**：用于签名和验证 JWT 刷新令牌
- **格式要求**：同 `JWT_SECRET`
- **安全性建议**：
  - 应与 `JWT_SECRET` 不同
  - 同样需要高强度随机性
  - 建议使用不同的密钥管理策略
- **默认值**：无（必需配置）

代码实现中，`JWT_SECRET` 被用于验证令牌：
```ts
verify(token.value, process.env.JWT_SECRET || 'secret')
```

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L81-L82)
- [.env.example](file://.env.example#L6)
- [src/lib/auth.ts](file://src/lib/auth.ts#L30)

## 应用基本信息配置
用于定义应用的元数据和前端可访问信息。

### NEXT_PUBLIC_APP_NAME
- **作用**：定义应用名称，可在前端代码中访问
- **格式要求**：任意字符串
- **安全性建议**：无特殊安全要求
- **默认值**：`Game Admin`

### NEXT_PUBLIC_APP_DESCRIPTION
- **作用**：定义应用描述信息
- **格式要求**：任意字符串
- **安全性建议**：无特殊安全要求
- **默认值**：`后台管理系统`

这些变量在配置文件中被引用：
```ts
process.env.NEXT_PUBLIC_APP_NAME || 'N Admin'
```

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L85-L86)
- [.env.example](file://.env.example#L2-L3)
- [src/config/site.ts](file://src/config/site.ts#L2-L3)

## 邮件服务配置
用于配置系统邮件发送功能（可选配置）。

### EMAIL_FROM
- **作用**：设置发件人邮箱地址
- **格式要求**：有效的电子邮件地址格式
- **安全性建议**：使用经过验证的域名邮箱
- **默认值**：无

### SMTP_HOST
- **作用**：SMTP 服务器主机地址
- **格式要求**：域名或 IP 地址
- **安全性建议**：优先使用加密连接（SSL/TLS）
- **默认值**：无

### SMTP_PORT
- **作用**：SMTP 服务器端口
- **格式要求**：有效端口号（如 587、465）
- **安全性建议**：
  - 使用标准安全端口
  - 避免使用未加密的 25 端口
- **默认值**：无

### SMTP_USER
- **作用**：SMTP 认证用户名
- **格式要求**：字符串
- **安全性建议**：使用专用邮件发送账户
- **默认值**：无

### SMTP_PASSWORD
- **作用**：SMTP 认证密码
- **格式要求**：字符串
- **安全性建议**：
  - 应为高强度密码
  - 建议使用应用专用密码或令牌
  - 绝对不可在代码或版本控制中明文存储
- **默认值**：无

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L89-L93)

## 部署环境管理策略
不同部署环境应采用差异化的环境变量管理策略。

### 开发环境
- 使用 `.env.local` 文件进行本地配置
- 可使用较弱的密钥（但仍需避免明文密码）
- 数据库可使用本地实例
- 邮件服务可配置为测试模式或禁用

### 测试环境
- 通过 CI/CD 系统注入环境变量
- 使用独立的测试数据库
- 密钥强度应与生产环境相当
- 邮件服务应配置为沙箱模式

### 生产环境
- 通过部署平台（如 Vercel）的安全环境变量功能配置
- 所有密钥必须为高强度随机字符串
- 数据库连接必须使用 SSL
- 定期轮换密钥和密码
- 实施严格的访问控制

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L32-L71)

## 敏感信息加密存储最佳实践
为确保系统安全，必须遵循以下敏感信息管理最佳实践。

### 密钥生成
- 使用安全的随机数生成器创建密钥
- 推荐使用 `openssl rand -base64 32` 生成 256 位密钥
- 避免使用可预测的字符串作为密钥

### 存储安全
- 永远不要将敏感信息提交到版本控制系统
- 使用 `.gitignore` 确保 `.env.local` 文件不被跟踪
- 在生产环境中使用专门的密钥管理服务（如 AWS KMS、Hashicorp Vault）

### 访问控制
- 限制环境变量的访问权限
- 实施最小权限原则
- 定期审计密钥使用情况

### 轮换策略
- 制定定期密钥轮换计划
- 在人员变动时立即轮换相关密钥
- 维护密钥轮换的审计日志

### 监控与告警
- 监控异常的认证尝试
- 设置密钥泄露的告警机制
- 记录所有与安全相关的操作日志

**Section sources**
- [DEPLOYMENT.md](file://DEPLOYMENT.md#L151-L154)
- [src/lib/logger.ts](file://src/lib/logger.ts#L20-L46)