# 贡献指南

<cite>
**Referenced Files in This Document**   
- [README.md](file://README.md)
- [package.json](file://package.json)
- [commitlint.config.js](file://commitlint.config.js)
- [eslint.config.mjs](file://eslint.config.mjs)
- [.husky/pre-commit](file://.husky/pre-commit)
</cite>

## 目录
1. [贡献流程](#贡献流程)
2. [代码规范](#代码规范)
3. [分支管理与代码审查](#分支管理与代码审查)
4. [开发环境配置](#开发环境配置)
5. [常见问题](#常见问题)

## 贡献流程

本项目欢迎外部贡献者参与开发。请遵循以下标准流程来为项目做出贡献，以确保代码质量和协作效率。

**Section sources**
- [README.md](file://README.md#L166-L172)

### 1. Fork 仓库
首先，在 GitHub 上 Fork `v0-game_admin` 仓库到您的个人账户。

### 2. 克隆项目
将您 Fork 的仓库克隆到本地开发环境。
```bash
git clone https://github.com/your-username/v0-game_admin.git
cd v0-game_admin
```

### 3. 创建功能分支
基于 `main` 分支创建一个新的功能分支。分支名称应清晰描述其功能。
```bash
git checkout -b feature/your-awesome-feature
```

### 4. 编写代码
在功能分支上进行代码开发。请确保您的代码符合项目的代码规范。

### 5. 使用 pnpm commit 进行提交
本项目使用 `commitlint` 和 `commitizen` 来规范 Git 提交信息。请使用以下命令进行提交，它将引导您完成符合约定的提交信息填写。
```bash
pnpm commit
```
该命令会启动交互式界面，帮助您选择合适的提交类型（如 `feat`、`fix` 等）并填写提交信息。

### 6. 推送分支
将您的功能分支推送到您的远程仓库。
```bash
git push origin feature/your-awesome-feature
```

### 7. 创建 Pull Request
访问 GitHub 上您的 Fork 仓库，系统通常会提示您创建 Pull Request (PR)。点击 "Compare & pull request"，填写 PR 描述，然后提交。项目维护者将对您的代码进行审查。

## 代码规范

为了保持代码库的整洁和一致性，项目强制执行严格的代码规范。

### ESLint 规则
项目使用 ESLint 进行代码静态检查。其核心配置继承自 `next/core-web-vitals` 和 `next/typescript`，并针对项目需求进行了定制。

主要规则包括：
- 关闭了 `@next/next/no-assign-module-variable` 规则以适应特定场景。
- 为提高开发效率，暂时关闭了 `@typescript-eslint/no-unused-vars` 和 `@typescript-eslint/no-explicit-any` 的严格检查。
- 关闭了 `react/no-unescaped-entities` 规则以处理特定的文本内容。

这些规则在 `eslint.config.mjs` 文件中定义，确保了 Next.js 最佳实践和 TypeScript 类型安全。

**Section sources**
- [eslint.config.mjs](file://eslint.config.mjs#L1-L25)

### Prettier 格式化
项目使用 Prettier 进行代码格式化，以保证所有贡献者的代码风格统一。虽然项目根目录下未找到独立的 `prettier.config.js` 文件，但其配置已集成在 `package.json` 的 `lint-staged` 字段中。

关键格式化规则：
- 代码缩进使用 2 个空格。
- 字符串使用单引号。
- 文件末尾自动添加换行。
- 一行最大长度为 100 个字符。

### 提交信息规范 (Commitlint)
提交信息必须遵循约定式提交（Conventional Commits）规范，由 `commitlint.config.js` 文件定义。有效的提交类型包括：
- `feat`: 新增功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整（不影响运行）
- `refactor`: 代码重构
- `perf`: 性能优化
- `test`: 测试相关
- `build`: 构建系统或依赖变更
- `ci`: CI 配置修改
- `chore`: 其他杂项修改
- `revert`: 撤销之前的提交

提交信息的类型、作用域和主题必须使用小写，主题行长度不得超过 100 个字符。

**Section sources**
- [commitlint.config.js](file://commitlint.config.js#L1-L41)

### 自动化代码检查
项目通过 Husky 钩子实现了自动化代码检查。当您执行 `git commit` 时，会触发 `pre-commit` 钩子，该钩子会调用 `lint-staged`。

`lint-staged` 会自动对暂存区的文件执行 Prettier 格式化，确保所有提交的代码都符合格式规范。这是通过 `package.json` 中的 `lint-staged` 配置实现的。

**Section sources**
- [.husky/pre-commit](file://.husky/pre-commit#L1)
- [package.json](file://package.json#L93-L99)

## 分支管理与代码审查

### 分支策略
本项目采用简单的分支管理策略：
- `main` 分支是唯一的主分支，代表生产环境的稳定代码。
- 所有新功能和修复都应在独立的功能分支（如 `feature/xxx` 或 `fix/xxx`）上开发。
- 功能开发完成后，通过 Pull Request 合并到 `main` 分支。

**Section sources**
- [README.md](file://README.md#L166-L172)

### 代码审查流程
1. **创建 PR**: 贡献者创建 Pull Request，并清晰地描述更改的目的、实现方式和测试情况。
2. **自动检查**: CI/CD 系统会自动运行 `pnpm lint` 和 `pnpm build` 等命令，检查代码质量和构建状态。
3. **人工审查**: 项目维护者会审查代码逻辑、设计、可读性和是否符合规范。
4. **讨论与修改**: 审查者和贡献者就代码进行讨论，贡献者根据反馈进行修改。
5. **合并**: 当所有审查通过且自动检查成功后，维护者将 PR 合并到 `main` 分支。

## 开发环境配置

为了高效地进行开发和测试，请按以下步骤配置您的开发环境。

### 环境要求
- **Node.js**: 版本 18.0 或更高。
- **包管理器**: `pnpm` 版本 9.0 或更高。
- **数据库**: PostgreSQL 或 MySQL。

### 安装与配置
1. **安装依赖**:
    ```bash
    pnpm install
    ```

2. **环境变量**:
    复制示例文件并根据您的环境进行配置。
    ```bash
    cp .env.example .env.local
    ```
    主要配置项包括 `DATABASE_URL`、`JWT_SECRET` 等。

3. **数据库初始化**:
    运行以下命令来生成数据库结构并初始化管理员账户。
    ```bash
    pnpm db:generate
    pnpm db:push
    pnpm init:admin
    ```

4. **启动开发服务器**:
    ```bash
    pnpm dev
    ```
    应用将在 `http://localhost:3001` 启动。

### 开发工具建议
- 使用支持 ESLint 和 Prettier 的代码编辑器（如 VS Code），并安装相应插件，以实现保存时自动格式化。
- 在提交代码前，可手动运行 `pnpm lint` 检查代码，并运行 `pnpm format` 格式化所有文件。

**Section sources**
- [README.md](file://README.md#L33-L64)
- [package.json](file://package.json#L5-L22)

## 常见问题

**Q: 运行 `pnpm commit` 时没有反应？**
A: 请确保您已安装所有依赖 (`pnpm install`)，并且 `husky` 已正确设置 (`pnpm prepare`)。

**Q: 我的提交被 `commitlint` 拒绝了怎么办？**
A: 请检查您的提交信息是否符合约定式提交规范。确保使用了正确的类型（如 `feat`、`fix`），并且主题行没有使用大写开头或句号结尾。

**Q: 如何运行测试？**
A: 项目目前的 `package.json` 中未定义测试脚本。如有测试需求，请联系项目维护者。